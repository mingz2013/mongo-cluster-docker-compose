@localhost ~/projects/mongo-cluster-docker-compose                                                                                                                                                                                                             [17:16:06]
> $ make                                                                                                                                                                                                                                                            [±main ●●▴]

Makefile for docker compose mongo cluster

Usage:
   make help                           show help

   make up                             启动服务
   make down                           停止服务
   make rm                             移除集群
   make logs                           查看日志


   make rm-data                        删除数据目录，谨慎操作，避免数据丢失


   make init-config                    初始化config集群
   make init-shard                     初始化shard1，shard2
   make add-shard                      shard1，shard2加入集群
   make create-database                创建database MyDatabase


   make echo-status                    查看集群状态
   make echo-shard-status              查看分片状态
   make others                         其他命令

                                                                                                                                                                                                                                                                           /0.1s

@localhost ~/projects/mongo-cluster-docker-compose                                                                                                                                                                                                             [17:16:08]
> $ make up                                                                                                                                                                                                                                                         [±main ●●▴]
docker-compose up -d
Creating network "mongo-cluster-docker-compose_default" with the default driver
Creating shardsvr-01-01 ... done
Creating shardsvr-02-01 ... done
Creating configsvr-02   ... done
Creating configsvr-03   ... done
Creating shardsvr-02-02 ... done
Creating shardsvr-01-02 ... done
Creating configsvr-01   ... done
Creating shardsvr-01-03 ... done
Creating shardsvr-02-03 ... done
Creating mongossvr-01   ... done
Creating mongossvr-02   ... done                                                                                                                                                                                                                                           /4.3s

@localhost ~/projects/mongo-cluster-docker-compose                                                                                                                                                                                                             [17:16:15]
> $ make init-config                                                                                                                                                                                                                                                [±main ●●▴]
docker-compose exec configsvr-01 sh -c "mongo < /scripts/config.initiate.js"
MongoDB shell version v4.4.1
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("ef5199ec-5f4b-4c40-947a-49c865a2fa07") }
MongoDB server version: 4.4.1
{
	"ok" : 1,
	"$gleStats" : {
		"lastOpTime" : Timestamp(1603358232, 1),
		"electionId" : ObjectId("000000000000000000000000")
	},
	"lastCommittedOpTime" : Timestamp(0, 0),
	"$clusterTime" : {
		"clusterTime" : Timestamp(1603358232, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	},
	"operationTime" : Timestamp(1603358232, 1)
}
bye                                                                                                                                                                                                                                                                        /1.2s

@localhost ~/projects/mongo-cluster-docker-compose                                                                                                                                                                                                             [17:17:12]
> $ make init-shard                                                                                                                                                                                                                                                   [±main ●]
docker-compose exec shardsvr-01-01 sh -c "mongo < /scripts/shard1.initiate.js"
MongoDB shell version v4.4.1
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("1b39f60c-674a-4f96-abfb-5ee4dc955747") }
MongoDB server version: 4.4.1
{
	"ok" : 1,
	"$clusterTime" : {
		"clusterTime" : Timestamp(1603358237, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	},
	"operationTime" : Timestamp(1603358237, 1)
}
bye
docker-compose exec shardsvr-02-01 sh -c "mongo < /scripts/shard2.initiate.js"
MongoDB shell version v4.4.1
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("4263bdc1-b207-43ff-a160-a2956337a067") }
MongoDB server version: 4.4.1
{
	"ok" : 1,
	"$clusterTime" : {
		"clusterTime" : Timestamp(1603358238, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	},
	"operationTime" : Timestamp(1603358238, 1)
}
bye                                                                                                                                                                                                                                                                        /1.9s

@localhost ~/projects/mongo-cluster-docker-compose                                                                                                                                                                                                             [17:17:18]
> $ make add-shard                                                                                                                                                                                                                                                    [±main ●]
docker-compose exec mongossvr-01 sh -c "mongo < /scripts/mongos.addshard.js"
MongoDB shell version v4.4.1
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("04d2cb25-2c4c-451a-9233-d3aa45c2ac24") }
MongoDB server version: 4.4.1
{
	"shardAdded" : "rs-shard-server-01",
	"ok" : 1,
	"operationTime" : Timestamp(1603358251, 6),
	"$clusterTime" : {
		"clusterTime" : Timestamp(1603358251, 6),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	}
}
{
	"shardAdded" : "rs-shard-server-02",
	"ok" : 1,
	"operationTime" : Timestamp(1603358254, 2),
	"$clusterTime" : {
		"clusterTime" : Timestamp(1603358255, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	}
}
bye                                                                                                                                                                                                                                                                        /9.7s

@localhost ~/projects/mongo-cluster-docker-compose                                                                                                                                                                                                             [17:17:35]
> $ make create-database                                                                                                                                                                                                                                              [±main ●]
docker-compose exec mongossvr-01 sh -c "mongo < /scripts/mongos.create.database.js"
MongoDB shell version v4.4.1
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("96fdeafe-eeb0-4351-aaa2-2cd6ee45064d") }
MongoDB server version: 4.4.1
{
	"ok" : 1,
	"operationTime" : Timestamp(1603358265, 4),
	"$clusterTime" : {
		"clusterTime" : Timestamp(1603358265, 4),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	}
}
{
	"collectionsharded" : "MyDatabase.MyCollection",
	"collectionUUID" : UUID("0567e304-0206-4ab9-8f59-e5a7d1ad4e75"),
	"ok" : 1,
	"operationTime" : Timestamp(1603358269, 14),
	"$clusterTime" : {
		"clusterTime" : Timestamp(1603358269, 14),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	}
}
bye                                                                                                                                                                                                                                                                        /6.3s

@localhost ~/projects/mongo-cluster-docker-compose                                                                                                                                                                                                             [17:17:49]
> $ mongo --port 27017                                                                                                                                                                                                                                                [±main ●]
MongoDB shell version v4.2.0
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("386bf9be-0848-40e2-936c-5b30e524cfa3") }
MongoDB server version: 4.4.1
WARNING: shell and server versions do not match
Server has startup warnings:
{"t":{"$date":"2020-10-22T09:16:15.649+00:00"},"s":"W",  "c":"CONTROL",  "id":22120,   "ctx":"main","msg":"Access control is not enabled for the database. Read and write access to data and configuration is unrestricted","tags":["startupWarnings"]}
mongos> show dbs
MyDatabase  0.000GB
admin       0.000GB
config      0.001GB
dmongos>use MyDatabase
switched to db MyDatabase
mongos> show collections
MyCollection
mongos> db.MyCollection.getShard
db.MyCollection.getShardDistribution(  db.MyCollection.getShardVersion(
mongos> db.MyCollection.getShardDistribution()

Shard rs-shard-server-01 at rs-shard-server-01/shardsvr-01-01:27017,shardsvr-01-02:27017,shardsvr-01-03:27017
 data : 0B docs : 0 chunks : 0
 estimated data per chunk : 0B
 estimated docs per chunk : 0

Shard rs-shard-server-02 at rs-shard-server-02/shardsvr-02-01:27017,shardsvr-02-02:27017,shardsvr-02-03:27017
 data : 0B docs : 0 chunks : 0
 estimated data per chunk : 0B
 estimated docs per chunk : 0

Totals
 data : 0B docs : 0 chunks : 0
 Shard rs-shard-server-01 contains 0% data, 0% docs in cluster, avg obj size on shard : 0B
 Shard rs-shard-server-02 contains 0% data, 0% docs in cluster, avg obj size on shard : 0B


mongos>